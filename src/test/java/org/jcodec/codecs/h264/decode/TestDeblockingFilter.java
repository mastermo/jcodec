package org.jcodec.codecs.h264.decode;

import org.jcodec.codecs.h264.JAVCTestCase;
import org.jcodec.codecs.h264.decode.deblock.DeblockingFilter;
import org.jcodec.codecs.h264.decode.deblock.FilterParameter;
import org.jcodec.codecs.h264.decode.deblock.FilterParameterBuilder;
import org.jcodec.codecs.h264.decode.model.DecodedMBlock;
import org.jcodec.codecs.h264.io.model.MBlockIntraNxN;
import org.jcodec.common.model.ColorSpace;
import org.jcodec.common.model.Picture;
import org.junit.Test;

public class TestDeblockingFilter extends JAVCTestCase {
	
	@Test
	public void test() throws Exception {
		Picture blocky = new Picture(32, 32, new int[][] {new int[] {
				139, 115, 108, 182, 222, 225, 230, 232, 232, 232, 232, 232, 233, 233, 233, 233, 237, 237, 237, 237, 231, 231, 231, 231, 230, 230, 230, 230, 206, 199, 199, 206, 
				115, 160, 192, 221, 222, 225, 230, 232, 232, 232, 232, 232, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 231, 231, 231, 231, 220, 210, 202, 204, 
				196, 212, 220, 220, 222, 225, 230, 232, 232, 232, 232, 232, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 235, 235, 235, 235, 220, 210, 202, 204, 
				212, 213, 220, 219, 222, 225, 230, 232, 232, 232, 232, 232, 208, 208, 208, 208, 192, 192, 192, 192, 186, 186, 186, 186, 193, 193, 193, 193, 206, 199, 199, 206, 

				216, 216, 216, 216, 228, 237, 231, 217, 204, 189, 173, 159, 153, 140, 127, 124, 103, 106, 111, 113, 106, 101, 105, 114, 133, 136, 149, 161, 172, 174, 179, 182, 
				216, 216, 216, 216, 227, 224, 203, 187, 178, 159, 134, 123, 103, 100,  97,  98,  84,  86,  88,  89,  82,  77,  81,  90,  93, 112, 126, 141, 158, 178, 190, 183, 
				216, 216, 216, 216, 212, 193, 164, 155, 139, 128, 111, 106,  97,  98,  99,  99, 106, 105, 103, 101,  94,  89,  93, 102,  79,  87, 100, 129, 131, 158, 186, 186, 
				216, 216, 216, 216, 172, 151, 130, 129, 111, 111, 111, 111, 123, 123, 123, 123, 124, 122, 117, 114, 107, 102, 106, 115, 101,  84,  86, 106, 118, 135, 170, 188, 

				217, 214, 211, 165, 122, 121, 123, 109, 110, 113, 118, 120, 111, 107, 102, 107, 114, 114, 114, 114, 115, 108, 106, 103, 112, 106, 101, 100, 110, 136, 165, 177, 
				207, 212, 185, 126, 122, 121, 120, 114, 112, 110, 105, 102,  86,  91,  95, 100, 114, 114, 114, 114, 111, 107,  94,  85,  84,  90, 101, 107, 115, 137, 169, 190, 
				210, 205, 158, 116, 128, 115, 112, 118, 112, 110, 105, 102,  95, 100, 104, 104, 114, 114, 114, 114, 113, 106,  91,  87,  76,  86,  94, 100, 127, 160, 187, 199, 
				205, 187, 143, 130, 119, 104, 102, 112, 110, 113, 118, 120, 120, 120, 120, 120, 114, 114, 114, 114, 111, 106, 104, 104,  99, 104, 103, 101, 147, 186, 203, 195, 

				167, 187, 150, 127, 105,  84, 107, 122, 120, 125, 123, 113, 107, 100, 101, 110, 119, 119, 117, 117, 113, 112, 106, 101, 105, 111, 115, 133, 184, 202, 206, 206, 
				141, 160, 168, 133, 100,  87, 111, 125, 124, 120, 112, 108,  95,  86,  85,  92, 106, 114, 114, 112, 117, 104,  89,  87,  91,  98, 107, 127, 200, 202, 204, 206, 
				110, 104, 144, 162,  98,  86, 114, 132, 125, 111, 100, 100,  99,  87,  78,  82,  96, 110, 118, 118, 103,  77,  68,  84,  87,  86,  94, 127, 200, 200, 204, 206, 
				 98, 109, 105, 123,  97,  84, 116, 135, 127, 110,  99, 100,  92,  78,  67,  69,  92, 105, 119, 127, 109,  70,  51,  70,  87,  82,  91, 128, 198, 200, 204, 206, 

				109, 109, 109, 109,  81,  79, 117, 131, 120, 111,  93,  80,  73,  65,  65,  73,  98, 109, 122, 132, 116,  83,  55,  55,  53,  74,  89, 141, 193, 205, 201, 201, 
				109, 109, 109, 109,  97,  77, 113, 141, 126, 120, 108,  93,  96,  88,  88,  96, 108, 118, 130, 136, 128, 107,  85,  68,  88, 102, 106, 134, 182, 207, 204, 210, 
				109, 109, 109, 109, 113,  91, 119, 145, 136, 128, 120, 111, 109, 101, 101, 109, 120, 126, 135, 137, 140, 121, 107,  96,  93, 103, 116, 126, 134, 186, 213, 203, 
				109, 109, 109, 109, 113, 105, 131, 139, 141, 136, 126, 120, 128, 120, 120, 128, 133, 135, 139, 141, 148, 127, 115, 116, 115, 119, 130, 131, 114, 128, 183, 207, 

				 99, 101, 105, 107, 117, 109, 135, 143, 145, 143, 139, 131, 126, 125, 123, 123, 126, 123, 143, 169, 178, 143, 119, 122, 122, 126, 137, 138, 105, 102, 127, 172, 
				 91,  95, 101, 105, 117, 109, 135, 143, 146, 145, 143, 139, 137, 132, 131, 129, 135, 134, 154, 177, 188, 153, 121, 116, 122, 126, 137, 138,  91,  87, 108, 126, 
				 75,  81,  95, 101, 117, 109, 135, 143, 147, 146, 145, 143, 140, 132, 127, 126, 132, 136, 154, 169, 180, 153, 121, 108, 122, 126, 137, 138, 103,  91,  93, 105, 
				 67,  75,  91,  99, 117, 109, 135, 143, 147, 147, 146, 145, 134, 129, 121, 116, 114, 126, 141, 150, 162, 143, 119, 106, 122, 126, 137, 138, 112,  95,  87,  96, 

				 47,  47,  65,  82, 111, 124, 133, 142, 144, 141, 139, 138, 128, 126, 123, 120,  96,  89,  99, 121, 128, 110, 105, 113, 115, 122, 131, 138, 104,  91,  92,  96, 
				 72,  60,  51,  55, 105, 125, 132, 137, 139, 138, 136, 136, 131, 128, 125, 123, 110, 102, 102, 114, 110, 103, 113, 124, 117, 115, 122, 131,  97,  91,  94,  96, 
				100,  81,  60,  57,  91, 127, 132, 133, 136, 136, 135, 135, 136, 133, 130, 128, 123, 120, 110, 104, 105, 113, 126, 135, 127, 117, 115, 122,  91,  92,  96,  96, 
				102,  90,  82,  87,  75, 120, 132, 131, 135, 135, 135, 135, 138, 136, 133, 130, 124, 124, 111,  96, 113, 124, 135, 140, 137, 127, 117, 115,  91,  94,  96,  96, 

				115, 110, 100,  95,  91,  89,  90, 114, 139, 139, 139, 141, 139, 137, 131, 124, 131, 125, 115, 108, 118, 117, 127, 123, 126, 138, 140, 108,  92,  95,  97,  97, 
				118, 113, 103,  98,  95,  81,  67, 106, 139, 139, 140, 141, 133, 121, 104,  97,  98,  97,  95,  92,  91,  78,  82,  85, 116, 132, 142, 114,  90,  93,  95,  95, 
				123, 118, 108, 103,  93,  77,  66, 100, 139, 139, 141, 141, 135, 107,  78,  75,  92,  96, 104, 106,  86,  83,  93,  90, 112, 128, 138, 110,  86,  89,  91,  91, 
				125, 120, 110, 105,  92,  77,  74, 106, 139, 140, 141, 140, 137, 119, 119, 136, 144, 136, 120, 111, 108, 128, 148, 133, 118, 130, 132, 100,  84,  87,  89,  89 
  
		}, 
		new int[] {
				119, 122, 128, 131, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 
				119, 121, 124, 126, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 
				121, 119, 116, 114, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 
				121, 118, 112, 109, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 

				111, 103, 103, 111, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				114, 106, 106, 114, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				119, 111, 111, 119, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				121, 113, 113, 121, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 

				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 

				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118

		}, new int[] {
				119, 122, 128, 131, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 
				119, 121, 124, 126, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 
				121, 119, 116, 114, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 
				121, 118, 112, 109, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 

				111, 103, 103, 111, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				114, 106, 106, 114, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				119, 111, 111, 119, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				121, 113, 113, 121, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 

				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 

				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 116, 118, 118, 118, 118, 118, 118, 118, 118

		}}, ColorSpace.YUV420);
		
		Picture smooth = new Picture(32, 32, new int[][] {new int[] {
				139, 115, 108, 182, 222, 225, 230, 232, 232, 232, 232, 232, 233, 234, 234, 235, 236, 236, 236, 235, 233, 232, 231, 231, 230, 230, 230, 230, 206, 199, 199, 206, 
				115, 160, 192, 221, 222, 225, 230, 232, 232, 232, 233, 234, 234, 235, 236, 236, 236, 236, 236, 236, 236, 236, 235, 234, 233, 232, 231, 231, 220, 210, 202, 204, 
				196, 212, 220, 219, 223, 225, 230, 232, 232, 232, 233, 234, 234, 235, 236, 236, 236, 236, 236, 236, 236, 236, 236, 236, 235, 235, 235, 235, 220, 210, 202, 204, 
				212, 214, 217, 218, 224, 225, 230, 232, 232, 232, 232, 232, 208, 208, 208, 204, 196, 192, 191, 190, 188, 187, 187, 189, 190, 192, 193, 193, 206, 199, 199, 206, 

				216, 215, 217, 218, 225, 237, 231, 217, 204, 189, 173, 159, 153, 140, 127, 124, 103, 106, 111, 111, 108, 102, 105, 114, 133, 136, 149, 161, 172, 174, 179, 182, 
				216, 215, 216, 217, 224, 224, 203, 187, 178, 159, 134, 123, 103, 100,  97,  95,  88,  86,  87,  87,  84,  78,  81,  90,  93, 112, 126, 141, 158, 178, 190, 183, 
				216, 215, 216, 216, 212, 193, 164, 155, 139, 128, 111, 103, 100, 100,  99, 101, 104, 105, 102,  99,  96,  90,  93, 102,  79,  87, 100, 129, 131, 158, 186, 186, 
				216, 216, 216, 216, 172, 151, 130, 126, 114, 113, 113, 115, 119, 121, 123, 123, 123, 122, 117, 112, 109, 103, 106, 115, 101,  84,  86, 106, 118, 135, 170, 188, 

				217, 214, 211, 165, 122, 121, 123, 109, 110, 113, 118, 118, 113, 107, 102, 106, 111, 114, 114, 114, 115, 108, 106, 103, 112, 106, 101, 100, 110, 136, 165, 177, 
				207, 212, 185, 126, 122, 121, 120, 114, 112, 110, 105, 100,  88,  91,  95, 101, 109, 114, 113, 113, 112, 107,  94,  85,  84,  90, 101, 107, 115, 137, 169, 190, 
				210, 205, 158, 116, 128, 115, 114, 115, 113, 112, 105, 100,  97, 100, 104, 107, 112, 115, 114, 114, 112, 106,  91,  87,  76,  86,  94, 100, 127, 160, 187, 198, 
				205, 187, 143, 130, 119, 104, 102, 115, 114, 116, 118, 120, 120, 120, 120, 119, 116, 116, 115, 115, 112, 106, 104, 102, 101, 103, 103, 101, 147, 186, 203, 198, 

				167, 187, 150, 127, 105,  84, 107, 119, 116, 122, 123, 113, 107, 100, 101, 110, 119, 117, 115, 115, 113, 112, 106, 101, 105, 111, 115, 133, 184, 202, 206, 203, 
				141, 160, 168, 133, 100,  85, 112, 125, 122, 120, 112, 108,  95,  86,  85,  92, 106, 114, 115, 113, 117, 104,  89,  87,  91,  98, 107, 127, 200, 202, 204, 205, 
				110, 104, 144, 162,  98,  84, 115, 132, 125, 111, 100, 100,  99,  87,  78,  82,  96, 110, 118, 118, 103,  77,  68,  84,  87,  86,  94, 127, 200, 200, 203, 206, 
				 98, 107, 105, 123,  97,  83, 115, 135, 126, 110,  99, 100,  92,  78,  67,  69,  92, 105, 119, 127, 109,  70,  51,  70,  87,  82,  91, 128, 198, 202, 203, 206, 

				109, 108, 109, 109,  81,  80, 116, 131, 124, 111,  93,  80,  73,  65,  65,  73,  98, 109, 122, 132, 116,  83,  55,  55,  53,  74,  89, 141, 193, 205, 203, 201, 
				109, 109, 109, 109,  97,  77, 116, 141, 126, 120, 108,  93,  96,  88,  88,  96, 108, 118, 130, 136, 128, 107,  85,  68,  88, 102, 106, 134, 182, 207, 204, 210, 
				109, 107, 108, 108, 113,  91, 121, 143, 136, 128, 120, 111, 109, 101, 101, 109, 120, 126, 135, 137, 140, 121, 107,  96,  93, 103, 116, 127, 134, 186, 213, 203, 
				109, 107, 108, 109, 115, 105, 131, 141, 142, 136, 129, 120, 128, 120, 120, 128, 133, 135, 139, 141, 148, 127, 115, 115, 116, 119, 130, 133, 114, 128, 183, 207, 

				 99, 103, 106, 107, 115, 109, 135, 141, 144, 143, 136, 131, 126, 125, 124, 124, 124, 123, 143, 169, 178, 143, 119, 121, 123, 126, 137, 136, 105, 102, 127, 172, 
				 91,  95, 101, 104, 116, 109, 135, 142, 145, 145, 139, 139, 137, 134, 131, 131, 134, 134, 154, 177, 188, 153, 121, 117, 121, 126, 137, 137,  91,  87, 108, 126, 
				 75,  81,  95, 101, 115, 111, 134, 142, 145, 144, 143, 141, 138, 131, 127, 129, 133, 136, 154, 169, 180, 153, 121, 108, 121, 126, 137, 138, 103,  91,  93, 105, 
				 67,  75,  91,  99, 116, 113, 134, 143, 147, 145, 142, 140, 135, 129, 122, 116, 114, 126, 141, 150, 162, 143, 119, 106, 120, 126, 137, 138, 112,  93,  87,  96, 

				 47,  47,  65,  82, 112, 120, 134, 142, 144, 143, 139, 137, 133, 128, 122, 120,  96,  89,  99, 121, 128, 110, 105, 113, 117, 122, 131, 138, 104,  93,  92,  96, 
				 72,  60,  51,  55, 105, 123, 132, 137, 139, 139, 137, 137, 134, 131, 125, 123, 110, 102, 102, 114, 110, 103, 113, 124, 117, 115, 122, 131,  97,  92,  94,  96, 
				100,  81,  60,  57,  91, 127, 131, 134, 137, 137, 137, 137, 135, 131, 129, 127, 123, 120, 110, 104, 105, 113, 126, 135, 127, 117, 115, 122,  91,  93,  95,  96, 
				104,  90,  82,  87,  75, 120, 132, 133, 136, 136, 136, 137, 137, 135, 133, 130, 126, 124, 111,  96, 113, 124, 135, 140, 137, 127, 117, 115,  92,  94,  97,  97, 

				113, 110, 100,  94,  92,  91,  90, 114, 136, 137, 138, 139, 140, 137, 131, 124, 131, 125, 115, 108, 118, 117, 127, 123, 126, 138, 140, 108,  91,  95,  96,  96, 
				118, 113, 103,  98,  95,  81,  67, 106, 137, 138, 139, 139, 133, 121, 104,  97,  98,  97,  95,  92,  91,  78,  82,  85, 116, 132, 142, 114,  90,  93,  95,  95, 
				123, 118, 108, 103,  93,  77,  66, 100, 139, 139, 141, 141, 135, 107,  78,  75,  92,  96, 104, 106,  86,  83,  93,  90, 112, 128, 138, 110,  86,  89,  91,  91, 
				125, 120, 110, 105,  92,  77,  74, 106, 139, 140, 141, 140, 137, 119, 119, 136, 144, 136, 120, 111, 108, 128, 148, 133, 118, 130, 132, 100,  84,  87,  89,  89 
  
		}, new int[] {
				119, 122, 128, 129, 128, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 
				119, 121, 124, 124, 123, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 
				121, 119, 116, 113, 112, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 
				118, 115, 109, 109, 110, 109, 109, 108, 109, 108, 108, 108, 108, 108, 108, 108, 

				114, 106, 106, 110, 113, 113, 113, 114, 113, 114, 114, 114, 114, 114, 114, 114, 
				114, 106, 106, 114, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				119, 111, 111, 119, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				119, 113, 113, 119, 116, 116, 116, 116, 117, 117, 117, 117, 117, 117, 117, 117, 

				118, 116, 116, 118, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 

				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118	
		}, new int[] {
				119, 122, 128, 129, 128, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 126, 
				119, 121, 124, 124, 123, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 121, 
				121, 119, 116, 113, 112, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 111, 
				118, 115, 109, 109, 110, 109, 109, 108, 109, 108, 108, 108, 108, 108, 108, 108, 

				114, 106, 106, 110, 113, 113, 113, 114, 113, 114, 114, 114, 114, 114, 114, 114, 
				114, 106, 106, 114, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				119, 111, 111, 119, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 116, 
				119, 113, 113, 119, 116, 116, 116, 116, 117, 117, 117, 117, 117, 117, 117, 117, 

				118, 116, 116, 118, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 

				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118, 
				117, 117, 117, 117, 116, 116, 116, 117, 118, 118, 118, 118, 118, 118, 118, 118
		}}, ColorSpace.YUV420);
		
		DecodedMBlock[] decoded = new DecodedMBlock[] {
				new DecodedMBlock(null, null, 28, null, null,
						new MBlockIntraNxN(0, null, new int[16], null,
								null)),
				new DecodedMBlock(null, null, 26, null, null,
						new MBlockIntraNxN(-2, null, new int[16], null,
								null)),
				new DecodedMBlock(null, null, 28, null, null,
						new MBlockIntraNxN(2, null, new int[16], null,
								null)),
				new DecodedMBlock(null, null, 26, null, null,
						new MBlockIntraNxN(-2, null, new int[16], null,
								null)) };

		FilterParameterBuilder builder = new FilterParameterBuilder();

		FilterParameter params[] = new FilterParameter[] {
				builder.calcParameterForMB(0, 0, 0, decoded[0], null, null,
						false, false),
				builder.calcParameterForMB(0, 0, 0, decoded[1], decoded[0],
						null, true, false),
				builder.calcParameterForMB(0, 0, 0, decoded[2], null,
						decoded[0], false, true),
				builder.calcParameterForMB(0, 0, 0, decoded[3], decoded[2],
						decoded[1], true, true) };

		// FrameUtil.displayFrame(blocky, true);
		DeblockingFilter deblockingFilter = new DeblockingFilter(2, 2, 8, 8);

		deblockingFilter.applyDeblocking(decoded, params);

		assertFrameEquals(smooth, blocky);
	}
}
